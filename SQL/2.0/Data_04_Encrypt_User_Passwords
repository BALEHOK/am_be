IF OBJECT_ID (N'dbo.tempEncryptPassword', N'FN') IS NOT NULL
  DROP FUNCTION tempEncryptPassword;
GO

CREATE FUNCTION dbo.tempEncryptPassword(@password nvarchar(255))
RETURNS varchar(255) 
AS
BEGIN
  DECLARE @Hashed varbinary(20);
    SET @Hashed = HASHBYTES('SHA1', @password);

    RETURN cast('' as xml).value('xs:base64Binary(sql:variable("@Hashed"))', 'nvarchar(255)');
END;
GO

update ADynEntityUser
  set [Password] = dbo.tempEncryptPassword([Password])
  where RIGHT([Password], 1) != '=' AND ActiveVersion = 1
GO

DROP FUNCTION tempEncryptPassword;
GO